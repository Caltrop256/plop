class Vec2{static from(e){return new Vec2(e.x,e.y)}static random(){return new Vec2(2*Math.random()-1,2*Math.random()-1)}constructor(e,t){this.x=e||0,this.y=t||0}add(e){return this.x+=e.x,this.y+=e.y,this}mult(e){return this.x*=e,this.y*=e,this}toString(){return this.x+", "+this.y}}class Point extends Vec2{static roughness=.5;bSkewed=!1;constructor(e,t){super(e,t),this.c=new Vec2(e,t)}reset(){this.bSkewed=!1,this.x=this.c.x,this.y=this.c.y}skew(e=1){return this.bSkewed=!0,this.x+=(2*Math.random()-1)*Point.roughness*e,this.y+=(2*Math.random()-1)*Point.roughness*e,this}}const range=(e,t,n)=>t+e*(n-t);class Primitive{constructor(e,t,n,s){this.p0=e,this.p1=t,this.control=n||new Point(range(.8,this.p0.x,this.p1.x),range(.8,this.p0.y,this.p1.y)),this.skewFactor=1}draw(e){e.moveTo(this.p0.x,this.p0.y),e.quadraticCurveTo(this.control.x,this.control.y,this.p1.x,this.p1.y)}skew(e){this.p0.bSkewed||this.p0.skew(this.skewFactor).add(e),this.p1.bSkewed||this.p1.skew(this.skewFactor).add(e),this.control.bSkewed||this.control.skew(3*this.skewFactor).add(e)}reset(){this.p0.reset(),this.p1.reset(),this.control.reset()}}class Drawable{constructor(t,e,n=1){this.points=[];for(let e=0;e<t.length;e+=2)this.points.push(new Point(t[e]*n,t[e+1]*n));this.parts=[],this.indC=e,this.buildParts(n)}buildParts(e){this.parts.length=0;for(const t of this.indC)3==t.length?this.parts.push(new Primitive(this.points[t[0]],this.points[t[1]],this.points[t[2]],e)):(this.parts.push(new Primitive(this.points[t[0]],this.points[t[1]],null,e)),.5<Math.random()&&this.parts.push(new Primitive(this.points[t[1]],this.points[t[0]],null,e)))}drawAt(e,t){e.beginPath();for(const n of this.parts)n.skew(t),n.draw(e);for(const s of this.parts)s.reset();e.stroke(),e.closePath()}}class Glyph{static create(e,t,n){e=Glyph.map[e]||Glyph.map[" "];return new Drawable(e[0],e[1],t,n)}static kerning={};static map={" ":[[7,0],[]],A:[[0,10,5,0,10,10,2.5,5,7.5,5],[[0,1],[1,2],[3,4]]],B:[[0,0,0,10,3,5,5,10,0,5,3,5,5,0],[[0,1],[1,2,3],[2,4],[5,0,6]]],C:[[5,0,-1,5,5,10,-1,0,-1,10],[[0,1,3],[1,2,4]]],D:[[0,0,0,10,5,5,5,10,5,0],[[0,1],[1,2,3],[2,0,4]]],E:[[7,0,0,0,0,5,5.5,5,0,10,7,10],[[0,1],[1,2],[2,3],[2,4],[4,5]]],F:[[7,0,0,0,0,5,5.5,5,0,10],[[0,1],[1,2],[2,3],[2,4]]],G:[[5,0,-1,5,2,10,5,5,2,5,7,5,-1,0,-1,10,5,10],[[0,1,6],[1,2,7],[2,3,8],[4,5]]],H:[[0,0,0,10,6,0,6,10,0,5,6,5],[[0,1],[2,3],[4,5]]],I:[[2,0,2,10,4,0],[[0,1]]],J:[[4,0,4,7,2,10,0,6,4,10,0,10],[[0,1],[1,2,4],[2,3,5]]],K:[[0,0,0,10,.5,5,4,0,4,10],[[0,1],[2,3],[2,4]]],L:[[0,0,0,10,6,10],[[0,1],[1,2]]],M:[[0,10,0,0,3.5,8,7,0,7,10],[[0,1],[1,2],[2,3],[3,4]]],N:[[0,10,0,0,5,10,5,0],[[0,1],[1,2],[2,3]]],O:[[4,0,0,5,4,10,8,5,0,0,0,10,8,10,8,0],[[0,1,4],[1,2,5],[2,3,6],[3,0,7]]],P:[[0,0,0,10,5,3.5,0,5,5,0,5,5],[[0,1],[0,2,4],[2,3,5]]],Q:[[4,0,0,5,4,10,8,5,0,0,0,10,8,10,8,0,9,10,4,6],[[0,1,4],[1,2,5],[2,3,6],[3,0,7],[8,9]]],R:[[0,0,0,10,5,3.5,0,5,5,0,5,5,5,10],[[0,1],[0,2,4],[2,3,5],[3,6]]],S:[[7,0,0,3.3,3.5,5.5,7,7,4.5,10,0,10,0,0,0,5.5,7,5.5,7,10],[[0,1,6],[1,2,7],[2,3,8],[3,4,9],[4,5]]],T:[[0,0,8,0,4,0,4,10],[[0,1],[2,3]]],U:[[0,0,0,7,4,10,8,7,8,0,0,10,8,10],[[0,1],[1,2,5],[2,3,6],[3,4]]],V:[[0,0,4,10,8,0],[[0,1],[1,2]]],W:[[0,0,0,10,3.5,2,7,10,7,0],[[0,1],[1,2],[2,3],[3,4]]],X:[[0,0,8,10,0,10,8,0],[[0,1],[2,3]]],Y:[[0,0,3.5,5,3.5,10,7,0],[[0,1],[1,2],[3,1]]],Z:[[0,0,8,0,0,10,8,10],[[0,1],[1,2],[2,3]]],0:[[4,0,0,5,4,10,8,5,0,0,0,10,8,10,8,0,0,0,8,10],[[0,1,4],[1,2,5],[2,3,6],[3,0,7],[8,9]]],1:[[4,0,4,10,0,5,2,10,6,10],[[0,1],[2,0],[3,4]]],2:[[0,2,2,0,8,3,6,6,0,10,8,10,8,0,8,5,0,1],[[0,1,8],[1,2,6],[2,3,7],[3,4],[4,5]]],3:[[0,2.5,3,0,6,2.5,3,5,6,7.5,3,10,0,7.5,0,0,6,0,6,5,6,10,0,10],[[0,1,7],[1,2,8],[2,3,9],[3,4,9],[4,5,10],[5,6,11]]],4:[[0,6,9,6,7,0,7,10],[[0,1],[0,2],[2,3]]],5:[[8,0,0,0,0,5,8,7.5,0,10,8,5,8,10],[[0,1],[1,2],[2,3,5],[3,4,6]]],6:[[8,2,6,0,0,5,5,10,7,6,4,4,0,7,8,0,0,0,0,10,7,10,7,4,2,4],[[0,1,7],[1,2,8],[2,3,9],[3,4,10],[4,5,11],[5,6,12]]],7:[[0,0,8,0,2,10,1,4.5,8,4.5,3,4],[[0,1],[1,2,5],[3,4]]],8:[[0,2,2,0,8,2,0,6,4,10,8,6,0,0,8,0,0,10,8,10],[[0,1,6],[1,2,7],[2,3],[3,4,8],[4,5,9],[5,0]]],9:[[3,0,0,3,3,6,6,3,0,0,0,6,6,6,6,0,6,7,2,10,6,10],[[0,1,4],[1,2,5],[2,3,6],[3,0,7],[3,8],[8,9,10]]],"-":[[0,6,4,6],[[0,1]]],"+":[[0,6,4,6,2,4,2,8],[[0,1],[2,3]]],",":[[1.3,9,0,13],[[0,1]]],"°":[[0,2,2,0,4,2,2,4,0,0,4,0,4,4,0,4],[[0,1,4],[1,2,5],[2,3,6],[3,0,7]]],".":[[0,9,1,10,2,9,1,8,0,10,2,10,2,8,0,8],[[0,1,4],[1,2,5],[2,3,6],[3,0,7]]],"\0":[[0,0,10,0,10,10,0,10,1,8,3,10,4,10,5,9,2.5,6.5,3.5,5.5,7.5,1.5,6,8,10,4],[[0,1],[1,2],[2,3],[3,0],[4,5],[6,7],[7,8],[4,8],[9,10],[9,11],[11,12],[10,12]]],"":[[4,5,5,4,6,5,5,6,4,4,6,4,6,6,4,6,3,5,0,5,4,3,1,1,0,2,7,5,10,5,6,3,9,1,10,1,4,7,2.5,9,6,7,7.5,9,5,10],[[0,1,4],[1,2,5],[2,3,6],[3,0,7],[8,9],[10,11],[8,10],[9,11,12],[13,14],[15,16],[13,15],[14,16,17],[18,19],[20,21],[18,20],[19,21,22]]],"":[[4,0,7,0,2,5,4,5,3,10,7,4,5,4],[[0,1],[0,2],[2,3],[3,4],[4,5],[5,6],[6,1]]],"":[[3,10,0,7,1.57,4.34,4.78,9.25,0,10,3.62,10.24,-.08,4.97,1.9,4.56,1.43,-.06,1.92,5.02,2.8,-.03,5.53,-.02,2,6.05,4.38,-.16,2.41,5.22,8.83,-.05,2.66,6.58,7.53,-.03,2.48,6.03,9.48,-.1,2.93,7.18,2.56,7.61,10.08,.73,10.16,3.95,3.68,8.34,10.22,2.16,3.12,7.93,4.17,8.6,11.41,5.13,4.7,8.8,9.96,7.13,9.35,8.93,4.81,9],[[0,1,4],[1,2,6],[0,3,5],[7,8],[9,10],[11,12],[13,14],[15,16],[17,18],[19,20],[21,22],[23,24],[25,26],[27,28],[29,30],[31,32]]],"":[[5,0,2,7,8,7,5,10,2,10,8,10,10,0],[[0,1],[0,2],[1,3,4],[2,3,5]]],"":[[5,5,1,10,9,10,3,4,3.5,4,3.5,4.5,3,4.5,7.3,3,7.8,3,7.8,3.5,7.3,3.5,4.3,1.7,4.8,1.7,4.8,2.2,4.3,2.2],[[0,1],[1,2],[2,0],[3,4],[4,5],[5,6],[6,3],[7,8],[8,9],[9,10],[10,7],[11,12],[12,13],[13,14],[14,11]]],"":[[0,0,0,10,10,10,10,0,2,2,8,2,8,8,2,8],[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4]]],"":[[.01,3,2.41,.57,4.41,1.4,6.82,2.98,.71,.76,3.57,.38,10.05,.22,5.32,2.91,9.44,2.37,4.25,7.35,2.24,6.25,3.74,6.25,0,9.04,6.78,8.96,.56,6.63,10.01,6.3,5.02,8.97,9.54,8.83,7.98,6.18],[[0,1,4],[1,2,5],[2,3,7],[3,6,8],[9,10,11],[10,12,14],[9,13,16],[15,13,17]]],"\b":[[0,0,0,10,10,10,10,0,8,1,9,2,7,2,8,3,2,7,3,8,8,1,9,2,1,9],[[0,1],[1,2],[2,3],[3,0],[4,5],[4,6],[6,7],[7,5],[8,9],[8,10],[9,11],[8,12],[9,12]]],"\t":[[0,0,0,10,10,10,10,0,0,4,10,4,1,4,1,5,3,4,3,5,5,4,5,6,7,4,7,5,9,4,9,5,0,6,10,6],[[0,1],[1,2],[2,3],[3,0],[4,5],[6,7],[8,9],[10,11],[12,13],[14,15],[16,17]]],"":[[0,0,0,10,10,10,10,0,2,8,8,2,5,2,8,5],[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[5,7]]],"":[[0,0,0,10,10,10,10,0,2,2,4,2,4,8,2,8,6,2,8,2,8,8,6,8],[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[8,9],[9,10],[10,11],[11,8]]],"":[[0,0,0,10,10,10,10,0,3,2.5,8,5,3,7.5],[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,4]]],"":[[0,0,0,10,10,10,10,0,5,2,8,5,5,8,2,5,8,2,8,8,2,8,2,2,3,6,3,9,5.7,8],[[0,1],[1,2],[2,3],[3,0],[4,5,8],[6,7,10],[7,4,11],[14,12],[14,13]]],"":[[0,0,0,10,10,10,10,0,8,2,2,8,6,2,8,4,4,8,2,6],[[0,1],[1,2],[2,3],[3,0],[4,5],[4,6],[4,7],[5,8],[5,9]]],"":[[0,0,0,10,10,10,10,0,5,2,8.7,5,5,8,2,2,4,2,4,8,2,8],[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,4],[7,8],[8,9],[9,10],[10,7]]],"":[[0,0,0,10,10,10,10,0,9,9,9,3,7,1,1,1,1,9,6,1,6,2.5,3,2.5,3,1,2.5,9,2.5,6,7.5,6,7.5,9],[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,8],[8,4],[9,10],[10,11],[11,12],[12,9],[13,14],[14,15],[15,16],[16,13]]],"":[[0,0,0,10,10,10,10,0,2.5,1,2.5,9,2.5,5,6,3.5,6,6.5,8.5,5],[[0,1],[1,2],[2,3],[3,0],[4,5],[6,7],[6,8],[6,9]]],"":[[0,0,0,10,10,10,10,0,3,1,3,5,1,5,5,10,9,5,7,5,7,1],[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,8],[8,9],[9,10],[10,4]]],"":[[0,0,0,10,10,10,10,0,5,0,9,5,7,5,7,9,3,9,3,5,1,5],[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,8],[8,9],[9,10],[10,4]]],"\v":[[0,0,10,0,10,10,0,10,9,2,8,3,7,2,8,1,1,5,2,4,3,5,2,6,9,8,8,9,7,8,8,7,7.5,2.5,2.5,4.5,2.5,5.5,7.5,7.5],[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[8,9],[9,10],[10,11],[11,8],[12,13],[13,14],[14,15],[15,12],[16,17],[18,19]]],"²":[[0,2,2,0,8,3,6,6,0,10,8,10,8,0,8,5,0,1].map((e,t)=>.4*e+(t%2==0?1.5:0)),[[0,1,8],[1,2,6],[2,3,7],[3,4],[4,5]]]}}for(const H in Glyph.map){const[I]=Glyph.map[H];let t=0;for(let e=0;e<I.length;e+=2)I[e]>t&&(t=I[e]);Glyph.kerning[H]=t}class EventHandler{hoveringInPreviousTick=[];mx=-1;my=-1;isPhone=!1;shiftKeyPressed=!1;constructor(){window.addEventListener("contextmenu",e=>e.preventDefault()),window.addEventListener("mousemove",e=>{this.isPhone||(this.mx=e.clientX,this.my=e.clientY,this.tick())}),window.addEventListener("mousedown",t=>{if(!this.isPhone){this.mx=t.clientX,this.my=t.clientY;let e=!1;for(const i of renderList)i.onmousedown&&i.visible&&i.pointInBoundary(this.mx,this.my)&&(i.onmousedown.apply(i,[t]),e=!0);if(1==t.button){var{x:n,y:s}=this.getCanvasCoords(),n=wasm.exports.getType(wasm.exports.getCell(n,s));n>lookup.EMPTY.id&&lookup[enumToString[n]].category!=categories.hidden&&(elementInBrush=n,null!=(s=Element.getElementIndexById("elementselect_"+lastSelected))&&delete renderList[s].clr,null!=(s=Element.getElementIndexById("cat_"+categorySelected))&&delete renderList[s].clr,lastSelected=lastSelected=lookup[enumToString[elementInBrush]].name||enumToString[elementInBrush],categorySelected=Object.getOwnPropertyNames(categories)[lookup[enumToString[n]].category],null!=(n=Element.getElementIndexById("elementselect_"+lastSelected))&&(renderList[n].clr=toolColors[0]),null!=(n=Element.getElementIndexById("cat_"+categorySelected))&&(renderList[n].clr=toolColors[0]))}else if(t.button<=2){const a=tools[0==t.button?0:1];a&&!e&&this.inCanvas()&&a.ondown(this.getCanvasCoords())}}}),window.addEventListener("mouseup",e=>{if(!this.isPhone){this.mx=e.clientX,this.my=e.clientY;const t=tools[0==e.button?0:1];t&&t.onup(this.getCanvasCoords())}}),window.addEventListener("touchstart",e=>{this.isPhone=!0,this.mx=e.changedTouches[0].clientX,this.my=e.changedTouches[0].clientY;let t=!1;for(const s of renderList)s.onmousedown&&s.visible&&s.pointInBoundary(this.mx,this.my)&&(s.onmousedown.apply(s,[{button:0,clientX:this.mx,clientY:this.my}]),t=!0);const n=tools[0];n&&!t&&this.inCanvas()&&n.ondown(this.getCanvasCoords())}),window.addEventListener("touchmove",e=>{this.isPhone=!0,this.mx=e.changedTouches[0].clientX,this.my=e.changedTouches[0].clientY,this.tick()}),window.addEventListener("touchend",e=>{this.isPhone=!0,this.mx=e.changedTouches[0].clientX,this.my=e.changedTouches[0].clientY;const t=tools[0];t&&t.onup(this.getCanvasCoords())}),window.addEventListener("keypress",e=>{/[1-5]/.test(e.key)?wasm.exports.changeScene(+e.key):!(e={d:"tool_draw",e:"tool_erase",l:"tool_line",w:"tool_wind"," ":"control_pause",".":"control_step",a:"control_reset",c:"control_resize",s:"control_save state",r:"control_load state"}[e.key.toLowerCase()])||(e=Element.getElementIndexById(e))&&renderList[e].onmousedown({button:0})}),window.addEventListener("keydown",e=>"shift"==e.key.toLowerCase()&&(this.shiftKeyPressed=!0)),window.addEventListener("keyup",e=>"shift"==e.key.toLowerCase()&&(this.shiftKeyPressed=!1)),window.addEventListener("focus",()=>{this.shiftKeyPressed=!1}),window.addEventListener("wheel",e=>{renderList[Element.getElementIndexById("tool_areaOfEffect")].onmousedown({button:e.deltaY<0?0:2})}),window.addEventListener("dragover",e=>e.preventDefault()),window.addEventListener("drop",e=>{e.preventDefault();const t=new FileReader;t.onloadend=()=>{var e=new Uint8Array(t.result);importData(e)&&(state=e)},t.readAsArrayBuffer(e.dataTransfer.files[0])})}inCanvas(){var{top:e,left:t,right:n,bottom:s}=canvas.getBoundingClientRect();return this.mx>t&&this.mx<n&&this.my>e&&this.my<s}getCanvasCoords(){var{left:e,top:t,width:n,height:s}=canvas.getBoundingClientRect();return{x:(this.mx-e)*(canvas.width/n)|0,y:(this.my-t)*(canvas.height/s)|0}}tick(){const n=[];let e=!1;for(const s of renderList)s.pointInBoundary(this.mx,this.my)&&(n.push(s),s.visible&&!s.id.startsWith("bounding_")&&(e=!0));e:for(let t=0;t<this.hoveringInPreviousTick.length;++t)if(this.hoveringInPreviousTick[t].onmouseexit&&this.hoveringInPreviousTick[t].visible){for(let e=0;e<n.length;++e)if(n[e]==this.hoveringInPreviousTick[t])continue e;this.hoveringInPreviousTick[t].onmouseexit.apply(n[t],n[t])}e:for(let t=0;t<n.length;++t)if(n[t].onmouseenter&&n[t].visible){for(let e=0;e<this.hoveringInPreviousTick.length;++e)if(n[t]==this.hoveringInPreviousTick[e])continue e;n[t].onmouseenter.apply(n[t],n[t])}if(!e&&this.inCanvas()){var t=this.getCanvasCoords();for(const i of tools)i.ontick(t)}this.hoveringInPreviousTick=n}}class Element{static getElementIndexById(t){for(let e=0;e<renderList.length;++e)if(renderList[e].id==t)return e;return null}left;right;top;bottom;id="unknown";get width(){return this.right-this.left}get height(){return this.bottom-this.top}get visible(){return this._visible}set visible(e){return this._visible=!!e}constructor(e){this.pivot=Vec2.from(e),this._visible=!0}pointInBoundary(e,t){return e>this.left&&e<this.right&&t>this.top&&t<this.bottom}on(e,t){this["on"+e]=t}}let frameExplosionPower=0;function line(e,t,n,s,i){var a=Math.abs(n-e),r=-Math.abs(s-t),o=e<n?1:-1,l=t<s?1:-1;let d=a+r;for(;;){if(i(e,t),e==n&&t==s)return;var h=2*d;r<=h&&(d+=r,e+=o),h<=a&&(d+=a,t+=l)}}(()=>{const o=document.getElementById("ui"),l=o.getContext("2d");window.renderList=[],setInterval(()=>{if(void 0!==wasm&&void 0!==infoNode){let e="0",t="VOID";var{x:n,y:s}=eventhandler.getCanvasCoords();eventhandler.inCanvas()&&(e=wasm.exports.getTemp(n,s).toFixed(1),t=enumToString[wasm.exports.getType(wasm.exports.getCell(n,s))]);s=`${n}x, ${canvas.height-s}y, ${e}°C, `+t;infoNode.changeText(s),frameExplosionPower<1?(frameExplosionPower=0,TextNode.shake=0,Point.roughness=0):(TextNode.shake=Math.min(25,frameExplosionPower/10),Point.roughness=10,frameExplosionPower*=.8),Point.roughness=Math.min(3,Math.max(0,e/250+.48))+frameExplosionPower/1e3,l.clearRect(0,0,o.width,o.height);for(const a of renderList)a.visible&&a.draw(l);var i=Math.min(.7,wasm.exports.getNSubatomics()/15e3);if(i){const r=l.getImageData(0,0,o.width,o.height);for(let e=3;e<r.data.length;e+=4)r.data[e]&&Math.random()<i&&(r.data[e]=0);l.putImageData(r,0,0)}}},50),window.addEventListener("resize",()=>{o.width=window.innerWidth,o.height=window.innerHeight,l.strokeStyle="#ffffff",renderList.length=0,window.constructUI(renderList)}),window.addEventListener("load",()=>{o.width=window.innerWidth,o.height=window.innerHeight,l.strokeStyle="#ffffff",renderList.length=0})})();class TextNode extends Element{static shake=0;constructor(e,t,n,s="left"){super(n),this.scale=t,this.justify=s,this._text="",this.changeText(e),this._text=e}changeText(t){if(t!=this._text){const i=(this._text=t).toUpperCase().split("\n");this.glyphs=[];let e=0;for(let n=0;n<i.length;++n){let t=0;for(let e=0;e<i[n].length;++e){var s=i[n].charAt(e);this.glyphs.push({drawable:Glyph.create(s,this.scale),pivot:new Vec2(t,0)}),t+=Glyph.kerning[s]*this.scale+2}t>e&&(e=t)}this.left=this.pivot.x,this.right=this.pivot.x+e,this.top=this.pivot.y,this.bottom=this.pivot.y+10*i.length*this.scale;var n=this.width;switch(this.justify){case"right":this.left-=n,this.right-=n;break;case"center":this.left-=n/2,this.right-=n/2}}}draw(e){this.clr&&(e.strokeStyle=this.clr);for(const t of this.glyphs)t.drawable.drawAt(e,new Vec2(this.left,this.top).add(t.pivot).add(Vec2.random().mult(TextNode.shake)));this.clr&&(e.strokeStyle="#ffffff")}}class Button extends Element{constructor(e,t,n){super(n);var s=4*t;this.label=new TextNode(e,t,new Vec2(n.x+s,n.y+s)),this.border=new Drawable([0,0,this.label.width+2*s,0,this.label.width+2*s,this.label.height+2*s,0,this.label.height+2*s],[[0,1],[1,2],[2,3],[3,0]]),this.left=this.label.left-s,this.right=this.label.right+s,this.top=this.label.top-s,this.bottom=this.label.bottom+s}draw(e){this.clr&&(e.strokeStyle=this.clr),this.label.draw(e),this.border.drawAt(e,this.pivot),this.clr&&(e.strokeStyle="#ffffff")}}class PaintTool{pressed=!1;mx=-1;my=-1;ondown({x:e,y:t}){this.mx=e,this.my=t,this.pressed=!0,this.applyPaint(this.mx,this.my)}onup(){this.pressed=!1}ontick({x:e,y:t}){this.pressed&&(line(this.mx,this.my,e,t,this.applyPaint),this.mx=e,this.my=t)}applyPaint(e,t){return eventhandler.shiftKeyPressed&&wasm.exports.eraseArea(e,t,areaOfEffect),wasm.exports.applyPaint(e,t,elementInBrush,areaOfEffect)}}class EraseTool{pressed=!1;mx=-1;my=-1;ondown({x:e,y:t}){this.mx=e,this.my=t,this.pressed=!0,this.applyPaint(this.mx,this.my)}onup(){this.pressed=!1}ontick({x:e,y:t}){this.pressed&&(line(this.mx,this.my,e,t,this.applyPaint),this.mx=e,this.my=t)}applyPaint(e,t){return wasm.exports.eraseArea(e,t,areaOfEffect)}}class LineTool{drawing=!1;anchorX=-1;anchorY=-1;tAX=-1;tAY=-1;mx=-1;my=-1;constructor(){var e=Element.getElementIndexById("tool_line_draw");null!=e?this.el=renderList[e]:(this.el=new Element(new Vec2),this.el.id="tool_line_draw",renderList.push(this.el)),this.el.draw=e=>{this.drawing&&new Drawable([this.anchorX,this.anchorY,this.mx,this.my],[[0,1]],1).drawAt(e,new Vec2)}}ondown({x:e,y:t}){this.tAX=e,this.tAY=t,this.mx=eventhandler.mx,this.my=eventhandler.my,this.anchorX=this.mx,this.anchorY=this.my,this.drawing=!0}onup({x:e,y:t}){this.drawing=!1,-1!=this.tAX&&-1!=this.tAY&&line(this.tAX,this.tAY,e,t,this.applyPaint),this.tAX=-1,this.tAY=-1}ontick({}){this.mx=eventhandler.mx,this.my=eventhandler.my}applyPaint(e,t){return eventhandler.shiftKeyPressed&&wasm.exports.eraseArea(e,t,areaOfEffect),wasm.exports.applyPaint(e,t,elementInBrush,areaOfEffect)}}class WindTool{pressed=!1;mx=-1;my=-1;ondown({x:e,y:t}){this.mx=e,this.my=t,this.pressed=!0}onup(){this.pressed=!1}ontick({x:e,y:t}){if(this.pressed){let n=this.mx,s=this.my;line(this.mx,this.my,e,t,(e,t)=>{wasm.exports.fluidVelocity(e,t,(e-n)*areaOfEffect*2.5,(t-s)*areaOfEffect*2.5+1),n=e,s=t}),this.mx=e,this.my=t}}}const canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d");let wasm,__memoryLen=0,imageData,areaOfEffect=3,elementInBrush,paused=!1,categorySelected="brittle",lastSelected="SAND",isUploading=!1,state=null;function setSize(e){canvas.width=75*e,canvas.height=75*e,wasm.exports.setSize(canvas.width,canvas.height);e=createView("Uint8Clamped","imageData",canvas.width*canvas.height*4,!0);imageData=new ImageData(e,canvas.width,canvas.height)}const toolList=[{name:"draw",symbol:"\b",constructor:PaintTool},{name:"erase",symbol:"\0",constructor:EraseTool},{name:"line",symbol:"\t",constructor:LineTool},{name:"wind",symbol:"",constructor:WindTool}],tools=[new PaintTool,new EraseTool],toolColors=["#ffd9b5","#b5f1ff"];let resizeMenuOpen=!1;const controls=[{name:"pause",symbol:"",callback(e,t){paused=!paused,e.changeText(paused?"":""),t.changeText(paused?"RESUME":"PAUSE")}},{name:"step",symbol:"",callback(){wasm.exports.tick()}},{name:"reset",symbol:"",callback(){wasm.exports.changeScene()}},{name:"resize",symbol:"",callback(){if(resizeMenuOpen)renderList[Element.getElementIndexById("resizeMenuCancel")].onmousedown();else{resizeMenuOpen=!0;var{top:s,left:i,right:a,bottom:r}=canvas.getBoundingClientRect(),o=Math.min(window.innerWidth)<741?range(Math.min(window.innerWidth)/741,.1,1.5):2;const d=new TextNode("Resize canvas",1.8*o,new Vec2(i+(a-i)/2,s+(r-s)/2-60*o),"center");renderList.push(d);let t=0;var l=[1,2,4,6,8,10,15,20];for(let e=0;e<l.length;++e)t+=new Button(75*l[e]+"²",+o,new Vec2).width+4*o;let n=0;const h=[];for(let e=0;e<l.length;++e){const u=l[e],f=new Button(75*l[e]+"²",+o,new Vec2(i+(a-i)/2+n-t/2,s+(r-s)/2-20*o));f.on("mouseenter",()=>{document.body.style.cursor="pointer"}),f.on("mouseexit",()=>{document.body.style.cursor="default"}),f.on("mousedown",()=>{setSize(u),renderList[Element.getElementIndexById("resizeMenuCancel")].onmousedown()}),n+=f.width+4*o,renderList.push(f),h.push(f)}var e=new Button("cancel",+o,new Vec2).width;const c=new Button("cancel",+o,new Vec2(i+(a-i)/2-e/2,s+(r-s)/2+5*o));c.id="resizeMenuCancel",c.on("mouseenter",()=>{document.body.style.cursor="pointer"}),c.on("mouseexit",()=>{document.body.style.cursor="default"}),c.on("mousedown",()=>{resizeMenuOpen=!1,renderList.splice(renderList.indexOf(c),1),renderList.splice(renderList.indexOf(d),1);for(const e of h)renderList.splice(renderList.indexOf(e),1)}),renderList.push(c)}}},{name:"save state",symbol:"",callback(){state=exportData()}},{name:"load state",symbol:"",callback(){state?importData(state):wasm.exports.changeScene(0)}},{name:"export state",symbol:"",callback(){state=exportData();var e=new Blob([state]),e=window.URL.createObjectURL(e);const t=document.createElement("a");t.style.display="none",t.href=e,t.download="state.plop",document.body.appendChild(t),t.click(),window.URL.revokeObjectURL(e),t.remove()}},{name:"import state",symbol:"",callback(){const e=document.createElement("input");e.type="file",e.style.display="none",document.body.appendChild(e),e.oninput=()=>{const t=new FileReader;t.onloadend=()=>{var e=new Uint8Array(t.result);importData(e)&&(state=e)},t.readAsArrayBuffer(e.files[0])},e.click(),e.remove()}},{name:"share state",symbol:"\v",callback(){isUploading||(isUploading=!0,state=exportData(),fetch("./plopstate.emb",{headers:{"Content-Type":"application/octet-stream","Content-Size":state.byteLength},method:"POST",body:state.buffer}).then(e=>{if(e.ok)e.text().then(e=>{history.pushState({},"","/plop/"+e+"/");var{top:t,left:n,right:s,bottom:i}=canvas.getBoundingClientRect(),a=Math.min(window.innerWidth)<741?range(Math.min(window.innerWidth)/741,.1,1.5):2;const r=new TextNode("Upload Successful",1.8*a,new Vec2(n+(s-n)/2,t+(i-t)/2-60*a),"center");renderList.push(r);e=4*a+new Button("Copy Link",1.2*a,new Vec2).width+new Button("Close",1.2*a,new Vec2).width;const o=new Button("Copy Link",1.2*a,new Vec2(n+(s-n)/2-e/2,t+(i-t)/2-40*a));o.on("mouseenter",()=>{document.body.style.cursor="pointer"}),o.on("mouseexit",()=>{document.body.style.cursor="default"}),o.on("mousedown",()=>{var e=window.location.href;if(window.clipboardData&&window.clipboardData.setData)return window.clipboardData.setData("Text",e);if(document.queryCommandSupported&&document.queryCommandSupported("copy")){const t=document.createElement("textarea");t.textContent=e,t.style.position="fixed",document.body.appendChild(t),t.select();try{return document.execCommand("copy")}catch(e){return console.warn("Copy to clipboard failed.",e),!1}finally{document.body.removeChild(t)}}}),renderList.push(o);const l=new Button("Close",1.2*a,new Vec2(n+(s-n)/2-e/2+o.width+2*a,t+(i-t)/2-40*a));l.on("mouseenter",()=>{document.body.style.cursor="pointer"}),l.on("mouseexit",()=>{document.body.style.cursor="default"}),l.on("mousedown",()=>{isUploading=!1,renderList.splice(renderList.indexOf(r),1),renderList.splice(renderList.indexOf(o),1),renderList.splice(renderList.indexOf(l),1)}),renderList.push(l)});else{switch(e.status){case 400:alert("You tried to upload an invalid File!");break;case 429:alert("You have hit the rate limit, please wait at least 3 minutes and try again!");break;case 413:alert("The file you tried to upload exceeds the file-size limit!");break;default:alert("An Unknown Error has occured, please try again later!")}isUploading=!1}}))}}],eventhandler=new EventHandler;let infoNode;function createView(e,t,n,s=!1){t=wasm.exports[t].value;return new window[e+"Array"](wasm.exports.memory.buffer,s?new Uint32Array(wasm.exports.memory.buffer,t,1)[0]:t,n||1)}function loop(){requestAnimationFrame(loop),eventhandler.tick(),__memoryLen&&wasm.exports.memory.buffer.byteLength!=__memoryLen&&(e=createView("Uint8Clamped","imageData",canvas.width*canvas.height*4,!0),imageData=new ImageData(e,canvas.width,canvas.height)),__memoryLen=wasm.exports.memory.buffer.byteLength,wasm.exports.draw(),paused||wasm.exports.tick(),ctx.putImageData(imageData,0,0);var e=wasm.exports.getFrameExplosionPower();e>frameExplosionPower&&(frameExplosionPower=e)}function generateFavicon(e){const t=document.createElement("canvas").getContext("2d");t.canvas.width=32,t.canvas.height=32,t.strokeStyle="#ffffff",Glyph.create(e,3,new Vec2).drawAt(t,new Vec2(1,1)),document.getElementById("favicon").href=t.canvas.toDataURL("image/png",10)}window.constructUI=o=>{resizeMenuOpen=!1,lastSelected=lookup[enumToString[elementInBrush]].name||enumToString[elementInBrush];const{top:l,left:d,right:e,bottom:t}=canvas.getBoundingClientRect(),h=Math.min(window.innerWidth)<741?range(Math.min(window.innerWidth)/741,.1,1.5):2;let c=8;for(const p in categories)if("pseudo"!=p&&"hidden"!=p){const w=new TextNode(catSymbols[categories[p]],h,new Vec2(d+c,l-13*h));w.id="cat_"+p;const g=[];let e=0,a=0,r=0;for(const b in lookup){const y=lookup[b];if(y.category==categories[p]){let t=c;const v=new Button(y.name||b,h,new Vec2(d+c-2*h,l+e));(y.name||b)==lastSelected&&(v.clr=toolColors[0]),v.id="elementselect_"+(y.name||b),v.visible=!1;let n=e;v.on("mousedown",()=>{var e=Element.getElementIndexById("elementselect_"+lastSelected);null!=e&&delete o[e].clr;e=Element.getElementIndexById("cat_"+categorySelected);null!=e&&delete o[e].clr,elementInBrush=y.id,v.clr=toolColors[0],lastSelected=y.name||b,categorySelected=p,w.clr=toolColors[0],o[Element.getElementIndexById("bounding_"+p)].onmouseexit(),generateFavicon(catSymbols[categories[p]]),v.onmouseexit()}),v.on("mouseenter",()=>{if(document.body.style.cursor="pointer",!eventhandler.isPhone){const e=new TextNode(lookup[b].description,.8*h,new Vec2(v.width+d+t+8*h,l+n+5*h));e.id="description_"+b,o.push(e)}}),v.on("mouseexit",()=>{document.body.style.cursor="default",eventhandler.isPhone||o.splice(Element.getElementIndexById("description_"+b))}),v.bottom>r&&(r=v.bottom),v.right>a&&(a=v.right),e+=v.height+4*h,o.push(v),g.push(v)}}w.on("mouseenter",()=>{if(!Element.getElementIndexById("bounding_"+p)){for(const s in categories){var e=Element.getElementIndexById("bounding_"+s);null!=e&&o[e].onmouseexit()}for(const i of g)i.visible=!0;const n=new TextNode(p,h,new Vec2(d+c+16*h,l-13*h));o.push(n);const t=new Element(new Vec2);t.draw=()=>{},t.id="bounding_"+p,t.top=-100,t.left=d-8,t.right=a+8,t.bottom=r+8,t.on("mouseexit",()=>{var e=Element.getElementIndexById("bounding_"+p);if(null!=e){for(const t of g)t.visible=!1;o.splice(e,1),o.splice(o.indexOf(n),1)}}),o.push(t)}}),c+=w.width+4*h,o.push(w)}let n;const s=new TextNode("Tool Strength",1.8,new Vec2(d+4*h,l+2*h*1.8));s.visible=!1;const i=new Element(new Vec2);i.id="tool_areaOfEffect",i.right=d-2,i.left=i.right-18*h-5,i.top=l,i.bottom=l+18*h,i.draw=e=>{n.drawAt(e,new Vec2(d-3*h-18*h,l))},i.on("mouseenter",()=>{document.body.style.cursor="pointer",s.visible=!0}),i.on("mouseexit",()=>{document.body.style.cursor="default",s.visible=!1}),i.on("mousedown",e=>{let t;if(0==e.button)switch(areaOfEffect){case 0:areaOfEffect=3,t=.7142857142857143;break;case 3:areaOfEffect=5,t=1.4285714285714286;break;case 5:areaOfEffect=7,t=2.142857142857143;break;case 7:areaOfEffect=10,t=2.857142857142857;break;case 10:areaOfEffect=15,t=3.5714285714285716;break;case 15:areaOfEffect=30,t=4.285714285714286;break;case 30:areaOfEffect=50,t=5;break;case 50:areaOfEffect=0,t=0}else switch(areaOfEffect){case 0:areaOfEffect=50,t=5;break;case 3:areaOfEffect=0,t=0;break;case 5:areaOfEffect=3,t=.7142857142857143;break;case 7:areaOfEffect=5,t=1.4285714285714286;break;case 10:areaOfEffect=7,t=2.142857142857143;break;case 15:areaOfEffect=10,t=2.857142857142857;break;case 30:areaOfEffect=15,t=3.5714285714285716;break;case 50:areaOfEffect=30,t=4.285714285714286}n=new Drawable([0,0,0,10,10,10,10,0,5+t,5,5,5+t,5-t,5,5,5-t,5+t,5+t,5-t,5+t,5-t,5-t,5+t,5-t],[[0,1],[1,2],[2,3],[3,0],[4,5,8],[5,6,9],[6,7,10],[7,4,11]],1.8*h)}),o.push(i,s),i.onmousedown({button:2}),i.onmousedown({button:0});let a=21*h*2,r=0;for(const x of toolList){const k=new TextNode(x.symbol,1.8*h,new Vec2(d-2*h,l+a),"right");x.node=k;let n=r;for(let e=0;e<2;++e)tools[e]instanceof x.constructor&&(tools[e]instanceof LineTool&&(tools[e]=new LineTool),k.clr=toolColors[e],tools[e].id=n);const E=new TextNode(x.name,h,new Vec2(d+4*h,l+a+3*h*1.8));E.visible=!1,o.push(E),k.on("mouseenter",()=>{document.body.style.cursor="pointer",E.visible=!0}),k.on("mouseexit",()=>{document.body.style.cursor="default",E.visible=!1}),k.on("mousedown",e=>{var t=0==e.button?0:1,e=+!t;!tools[t]||tools[t]instanceof x.constructor||(tools[e]instanceof x.constructor?(tools[e]=tools[t],"number"==typeof tools[e].id&&(toolList[tools[e].id].node.clr=toolColors[e])):"number"==typeof tools[t].id&&delete toolList[tools[t].id].node.clr,tools[t]=new x.constructor,tools[t].id=n,toolList[n].node.clr=toolColors[t])}),o.push(k),k.id="tool_"+x.name,a+=21*h,r+=1}a+=21*h*1;for(const A of controls){const z=new TextNode(A.symbol,1.8*h,new Vec2(d-2*h,l+a),"right"),T=new TextNode(A.name,h,new Vec2(d+4*h,l+a+3*h*1.8));T.visible=!1,z.on("mouseenter",()=>{document.body.style.cursor="pointer",T.visible=!0}),z.on("mouseexit",()=>{document.body.style.cursor="default",T.visible=!1}),z.on("mousedown",()=>{A.callback(z,T)}),o.push(z,T),z.id="control_"+A.name,a+=21*h,"resize"==A.name&&(a+=21*h)}infoNode=new TextNode("-1x, -1y, 0.2°C, VOID",h,new Vec2(e-8,l-13*h),"right"),o.push(infoNode);const u=new TextNode("plop",h,new Vec2(d+8,t+4*h));u.on("mouseenter",()=>document.body.style.cursor="pointer"),u.on("mouseexit",()=>document.body.style.cursor="default"),u.on("mousedown",()=>window.open("https://github.com/Caltrop256/plop")),o.push(u);const f=new TextNode("caltrop.dev",h,new Vec2(e-8,t+4*h),"right");f.on("mouseenter",()=>document.body.style.cursor="pointer"),f.on("mouseexit",()=>document.body.style.cursor="default"),f.on("mousedown",()=>window.open("https://caltrop.dev/")),o.push(f);const m=new Drawable([d,l,e,l,e,t,d,t],[[0,1],[1,2],[2,3],[3,0]],1),_=new Element(new Vec2);_.draw=e=>{paused&&(e.strokeStyle="#ff0000"),m.drawAt(e,new Vec2),e.strokeStyle="#ffffff"},o.push(_),o[Element.getElementIndexById("cat_"+categorySelected)].clr=toolColors[0]},async function(){fetch("sim.wasm").then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,{env:{log:console.log,cos:Math.cos,sin:Math.sin,atan2:Math.atan2}})).then(({instance:e})=>{wasm=e;e=new Uint32Array(6);crypto.getRandomValues(e),wasm.exports.seed(...e),readEnumArray(),elementInBrush=lookup.SAND.id,generateFavicon(catSymbols[2]),constructUI(renderList);e=location.pathname.match(/([a-zA-Z0-9_\-]{22,22})\/$/);e?(e=e[1],fetch("./plopstate.emb?f="+encodeURIComponent(e)).then(e=>{e.ok?e.arrayBuffer().then(e=>{var t;e.byteLength&&importData(t=new Uint8Array(e))?(state=t,renderList[Element.getElementIndexById("control_pause")].onmousedown()):setSize(4),loop()}):(setSize(4),loop())})):(setSize(4),loop())})}();const categories={pseudo:0,solid:1,brittle:2,liquid:3,gas:4,electronics:5,explosives:6,nuclear:7,hidden:8},catSymbols=[,"","","","","","",""],lookup={VOID:{id:0,category:categories.pseudo,description:"gender"},EMPTY:{id:1,category:categories.pseudo},SAND:{category:categories.brittle,description:"the primordial element, turns into glass when heated"},DIRT:{category:categories.brittle,description:"its... dirt"},COAL:{category:categories.brittle,description:"burns predictably"},SNOW:{category:categories.brittle,description:"beautiful"},COBBLESTONE:{category:categories.brittle,description:"heavy"},SEED:{category:categories.brittle,description:"grows into plant on sand or dirt"},STONE:{category:categories.solid,description:"strong insolator"},WOOD:{category:categories.solid,description:"helps plants grow, turns into coal when burned"},TITANIUM:{category:categories.solid,description:"immune to acid, very explosion resistent"},PLANT:{category:categories.solid,description:"flammable, decomposes into dirt"},ICE:{category:categories.solid,description:"cold"},GLASS:{category:categories.solid,description:"refracts light"},FUNGUS:{category:categories.solid,description:"spreads through solids"},WATER:{category:categories.liquid,description:"freezes when cold, turns to steam when hot"},CEMENT:{category:categories.liquid,description:"cures into stone"},OIL:{category:categories.liquid,description:"burns with a lot of smoke"},MAGMA:{category:categories.liquid,description:"very hot."},ACID:{category:categories.liquid,description:"destroys most materials, creates toxic smoke"},LIQUIDNITROGEN:{category:categories.liquid,description:"very cold, evaporates on contact",name:"nitrogen"},STEAM:{category:categories.gas,description:"precipitates water or snow"},SMOKE:{category:categories.gas,description:"chokes flames"},FOG:{category:categories.gas,description:"exists until it doesnt"},TOXIC:{category:categories.gas,description:"flammable, very light"},SPARK:{category:categories.electronics,description:"electric spark"},BATTERY:{category:categories.electronics,description:"produces infinite electricity"},COPPER:{category:categories.electronics,description:"conducts electricity, heats up"},TORCH:{category:categories.electronics,description:"creates fire when powered"},CONVEYER:{category:categories.electronics,description:"moves material in the direction it conducts"},PISTON:{category:categories.electronics,description:"extends to the left, completes circuits"},PUMP:{category:categories.hidden,description:"doesnt work,,,"},LIGHTNING:{category:categories.electronics,description:"discharges into the ground, destructive"},FIRE:{category:categories.explosives,description:"hot, ignites flamamble material"},FUSE:{category:categories.explosives,description:"burns slowly, sparks"},GUNPOWDER:{category:categories.explosives,description:"cute and valid"},DYNAMITE:{category:categories.explosives,description:"stable, detonates when sparked"},FIREWORK:{category:categories.explosives,description:"shoots up into the air"},THERMITE:{category:categories.explosives,description:"burns hot and violently"},NITRO:{category:categories.explosives,description:"highly volatile, very destructive"},ELECTRON:{category:categories.nuclear,description:"messes with the internals of material"},PROTON:{category:categories.nuclear,description:"heats elements up"},NEUTRON:{category:categories.nuclear,description:"changes atomic makeup of material"},PHOTON:{category:categories.nuclear,description:"pretty colors,,,,"},POLONIUM:{category:categories.nuclear,description:"decays into neutrons and plutonium"},PLUTONIUM:{category:categories.nuclear,description:"decays quickly, detonates when hot"},CLONER:{category:categories.nuclear,description:"copies nearby elements"},UNBREAKABLECLONER:{name:"cloner++",category:categories.nuclear,description:"harder, better, faster, stronger"},PELLET:{category:categories.hidden},DEBRIS:{category:categories.hidden}};function readcstr(e){var t=new Uint8Array(wasm.exports.memory.buffer,e);let n=0,s="";for(;t[n];)s+=String.fromCharCode(t[n++]);return s}const enumToString=["VOID","EMPTY"];function readEnumArray(){var e=new Uint32Array(wasm.exports.memory.buffer,wasm.exports.enumToString.value);let t=0;for(;e[t];){var n=readcstr(e[t++]);lookup[n].id=t+1,enumToString[t+1]=n}}function exportData(){var e=wasm.exports.exportData(),[,,,t,n,s]=new Uint32Array(wasm.exports.memory.buffer,e,6),i=t*n+s,a=new Uint8Array(wasm.exports.memory.buffer,e,i);const r=new Uint8Array(i);for(let e=0;e<i;++e)r[e]=a[e];return wasm.exports.free(e),pako.deflate(r)}function importData(e){try{var t=pako.inflate(e),n=t.byteLength,s=wasm.exports.malloc(n);const r=new Uint8Array(wasm.exports.memory.buffer,s,n);for(let e=0;e<n;++e)r[e]=t[e];var i=wasm.exports.importData(s);if(wasm.exports.free(s),!i)return console.error("Invalid File!"),!1;var a=t[8];canvas.width=75*a,canvas.height=75*a,imageData=new ImageData(createView("Uint8Clamped","imageData",canvas.width*canvas.height*4,!0),canvas.width,canvas.height)}catch(e){return console.error(e),console.error("Invalid File!"),!1}return!0}!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).pako={})}(this,function(e){"use strict";function t(e){let t=e.length;for(;0<=--t;)e[t]=0}const l=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),d=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),r=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),o=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),h=new Array(576);t(h);const c=new Array(60);t(c);const u=new Array(512);t(u);const f=new Array(256);t(f);const m=new Array(29);t(m);const _=new Array(30);function p(e,t,n,s,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=s,this.max_length=i,this.has_stree=e&&e.length}let w,g,b;function n(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}t(_);const y=e=>e<256?u[e]:u[256+(e>>>7)],i=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},v=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,i(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},x=(e,t,n)=>{v(e,n[2*t],n[2*t+1])},k=(e,t)=>{let n=0;for(;n|=1&e,e>>>=1,n<<=1,0<--t;);return n>>>1},E=(e,t,n)=>{const s=new Array(16);let i,a,r=0;for(i=1;i<=15;i++)s[i]=r=r+n[i-1]<<1;for(a=0;a<=t;a++){var o=e[2*a+1];0!==o&&(e[2*a]=k(s[o]++,o))}},A=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},z=e=>{8<e.bi_valid?i(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},a=(e,t,n,s)=>{var i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&s[t]<=s[n]},T=(e,t,n)=>{var s=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&a(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!a(t,s,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=s},L=(e,t,n)=>{let s,i,a,r,o=0;if(0!==e.last_lit)for(;s=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],i=e.pending_buf[e.l_buf+o],o++,0==s?x(e,i,t):(a=f[i],x(e,a+256+1,t),r=l[a],0!==r&&(i-=m[a],v(e,i,r)),s--,a=y(s),x(e,a,n),r=d[a],0!==r&&(s-=_[a],v(e,s,r))),o<e.last_lit;);x(e,256,t)},S=(e,_)=>{const t=_.dyn_tree,n=_.stat_desc.static_tree,s=_.stat_desc.has_stree,i=_.stat_desc.elems;let a,r,o,l=-1;for(e.heap_len=0,e.heap_max=573,a=0;a<i;a++)0!==t[2*a]?(e.heap[++e.heap_len]=l=a,e.depth[a]=0):t[2*a+1]=0;for(;e.heap_len<2;)o=e.heap[++e.heap_len]=l<2?++l:0,t[2*o]=1,e.depth[o]=0,e.opt_len--,s&&(e.static_len-=n[2*o+1]);for(_.max_code=l,a=e.heap_len>>1;1<=a;a--)T(e,t,a);for(o=i;a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],T(e,t,1),r=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=r,t[2*o]=t[2*a]+t[2*r],e.depth[o]=(e.depth[a]>=e.depth[r]?e.depth[a]:e.depth[r])+1,t[2*a+1]=t[2*r+1]=o,e.heap[1]=o++,T(e,t,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],(e=>{const t=_.dyn_tree,n=_.max_code,s=_.stat_desc.static_tree,i=_.stat_desc.has_stree,a=_.stat_desc.extra_bits,r=_.stat_desc.extra_base,o=_.stat_desc.max_length;let l,d,h,c,u,f,m=0;for(c=0;c<=15;c++)e.bl_count[c]=0;for(t[2*e.heap[e.heap_max]+1]=0,l=e.heap_max+1;l<573;l++)d=e.heap[l],c=t[2*t[2*d+1]+1]+1,c>o&&(c=o,m++),t[2*d+1]=c,d>n||(e.bl_count[c]++,u=0,d>=r&&(u=a[d-r]),f=t[2*d],e.opt_len+=f*(c+u),i&&(e.static_len+=f*(s[2*d+1]+u)));if(0!==m){do{for(c=o-1;0===e.bl_count[c];)c--}while(e.bl_count[c]--,e.bl_count[c+1]+=2,e.bl_count[o]--,m-=2,0<m);for(c=o;0!==c;c--)for(d=e.bl_count[c];0!==d;)n<(h=e.heap[--l])||(t[2*h+1]!==c&&(e.opt_len+=(c-t[2*h+1])*t[2*h],t[2*h+1]=c),d--)}})(e),E(t,l,e.bl_count)},I=(e,t,n)=>{let s,i,a=-1,r=t[1],o=0,l=7,d=4;for(0===r&&(l=138,d=3),t[2*(n+1)+1]=65535,s=0;s<=n;s++)i=r,r=t[2*(s+1)+1],++o<l&&i===r||(o<d?e.bl_tree[2*i]+=o:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,a=i,d=0===r?(l=138,3):i===r?(l=6,3):(l=7,4))},O=(e,t,n)=>{let s,i,a=-1,r=t[1],o=0,l=7,d=4;for(0===r&&(l=138,d=3),s=0;s<=n;s++)if(i=r,r=t[2*(s+1)+1],!(++o<l&&i===r)){if(o<d)for(;x(e,i,e.bl_tree),0!=--o;);else 0!==i?(i!==a&&(x(e,i,e.bl_tree),o--),x(e,16,e.bl_tree),v(e,o-3,2)):o<=10?(x(e,17,e.bl_tree),v(e,o-3,3)):(x(e,18,e.bl_tree),v(e,o-11,7));o=0,a=i,d=0===r?(l=138,3):i===r?(l=6,3):(l=7,4)}};let s=!1;const C=(e,t,n,s)=>{v(e,0+(s?1:0),3),e=e,t=t,n=n,z(e),i(e,n),i(e,~n),e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var R={_tr_init:e=>{s||((()=>{let e,t,n,s,i;const a=new Array(16);for(n=0,s=0;s<28;s++)for(m[s]=n,e=0;e<1<<l[s];e++)f[n++]=s;for(f[n-1]=s,i=0,s=0;s<16;s++)for(_[s]=i,e=0;e<1<<d[s];e++)u[i++]=s;for(i>>=7;s<30;s++)for(_[s]=i<<7,e=0;e<1<<d[s]-7;e++)u[256+i++]=s;for(t=0;t<=15;t++)a[t]=0;for(e=0;e<=143;)h[2*e+1]=8,e++,a[8]++;for(;e<=255;)h[2*e+1]=9,e++,a[9]++;for(;e<=279;)h[2*e+1]=7,e++,a[7]++;for(;e<=287;)h[2*e+1]=8,e++,a[8]++;for(E(h,287,a),e=0;e<30;e++)c[2*e+1]=5,c[2*e]=k(e,5);w=new p(h,l,257,286,15),g=new p(c,d,0,30,15),b=new p(new Array(0),r,0,19,7)})(),s=!0),e.l_desc=new n(e.dyn_ltree,w),e.d_desc=new n(e.dyn_dtree,g),e.bl_desc=new n(e.bl_tree,b),e.bi_buf=0,e.bi_valid=0,A(e)},_tr_stored_block:C,_tr_flush_block:(e,t,n,s)=>{let i,a,r=0;0<e.level?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),S(e,e.l_desc),S(e,e.d_desc),r=(e=>{let t;for(I(e,e.dyn_ltree,e.l_desc.max_code),I(e,e.dyn_dtree,e.d_desc.max_code),S(e,e.bl_desc),t=18;3<=t&&0===e.bl_tree[2*o[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,a<=i&&(i=a)):i=a=n+5,n+4<=i&&-1!==t?C(e,t,n,s):4===e.strategy||a===i?(v(e,2+(s?1:0),3),L(e,h,c)):(v(e,4+(s?1:0),3),((e,t,n,s)=>{let i;for(v(e,t-257,5),v(e,n-1,5),v(e,s-4,4),i=0;i<s;i++)v(e,e.bl_tree[2*o[i]+1],3);O(e,e.dyn_ltree,t-1),O(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,r+1),L(e,e.dyn_ltree,e.dyn_dtree)),A(e),s&&z(e)},_tr_tally:(e,t,n)=>(e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(f[n]+256+1)]++,e.dyn_dtree[2*y(t)]++),e.last_lit===e.lit_bufsize-1),_tr_align:e=>{v(e,2,3),x(e,256,h),16===(e=e).bi_valid?(i(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}},U=(e,t,n,s)=>{let i=65535&e|0,a=e>>>16&65535|0,r=0;for(;0!==n;){for(r=2e3<n?2e3:n,n-=r;i=i+t[s++]|0,a=a+i|0,--r;);i%=65521,a%=65521}return i|a<<16|0};const D=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var B=(t,n,e,s)=>{var i=D,a=s+e;t^=-1;for(let e=s;e<a;e++)t=t>>>8^i[255&(t^n[e])];return-1^t},N={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},P={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Z,_tr_stored_block:M,_tr_flush_block:F,_tr_tally:V,_tr_align:Y}=R,{Z_NO_FLUSH:H,Z_PARTIAL_FLUSH:K,Z_FULL_FLUSH:G,Z_FINISH:W,Z_BLOCK:X,Z_OK:j,Z_STREAM_END:q,Z_STREAM_ERROR:$,Z_DATA_ERROR:Q,Z_BUF_ERROR:J,Z_DEFAULT_COMPRESSION:ee,Z_FILTERED:te,Z_HUFFMAN_ONLY:ne,Z_RLE:se,Z_FIXED:ie,Z_UNKNOWN:ae,Z_DEFLATED:re}=P,oe=258,le=262,de=(e,t)=>(e.msg=N[t],t),he=e=>(e<<1)-(4<e?9:0),ce=e=>{let t=e.length;for(;0<=--t;)e[t]=0};let ue=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const fe=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},me=(e,t)=>{F(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,fe(e.strm)},_e=(e,t)=>{e.pending_buf[e.pending++]=t},pe=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},we=(e,t)=>{let n,s,i=e.max_chain_length,a=e.strstart,r=e.prev_length,o=e.nice_match;var l=e.strstart>e.w_size-le?e.strstart-(e.w_size-le):0,d=e.window,h=e.w_mask,c=e.prev,u=e.strstart+oe;let f=d[a+r-1],m=d[a+r];e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do{if(n=t,d[n+r]===m&&d[n+r-1]===f&&d[n]===d[a]&&d[++n]===d[a+1]){for(a+=2,n++;d[++a]===d[++n]&&d[++a]===d[++n]&&d[++a]===d[++n]&&d[++a]===d[++n]&&d[++a]===d[++n]&&d[++a]===d[++n]&&d[++a]===d[++n]&&d[++a]===d[++n]&&a<u;);if(s=oe-(u-a),a=u-oe,s>r){if(e.match_start=t,(r=s)>=o)break;f=d[a+r-1],m=d[a+r]}}}while((t=c[t&h])>l&&0!=--i);return r<=e.lookahead?r:e.lookahead},ge=e=>{var t=e.w_size;let n,s,i,a,r;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-le)){for(e.window.set(e.window.subarray(t,t+t),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,s=e.hash_size,n=s;i=e.head[--n],e.head[n]=i>=t?i-t:0,--s;);for(s=t,n=s;i=e.prev[--n],e.prev[n]=i>=t?i-t:0,--s;);a+=t}if(0===e.strm.avail_in)break;if(s=((e,t,n,s)=>{let i=e.avail_in;return i>s&&(i=s),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=U(e.adler,t,i,n):2===e.state.wrap&&(e.adler=B(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)})(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=s,3<=e.lookahead+e.insert)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=ue(e,e.ins_h,e.window[r+1]);e.insert&&(e.ins_h=ue(e,e.ins_h,e.window[r+3-1]),e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<le&&0!==e.strm.avail_in)},be=(e,t)=>{let n,s;for(;;){if(e.lookahead<le){if(ge(e),e.lookahead<le&&t===H)return 1;if(0===e.lookahead)break}if(n=0,3<=e.lookahead&&(e.ins_h=ue(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-le&&(e.match_length=we(e,n)),3<=e.match_length)if(s=V(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&3<=e.lookahead){for(e.match_length--;e.strstart++,e.ins_h=ue(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=ue(e,e.ins_h,e.window[e.strstart+1]);else s=V(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(me(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===W?(me(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(me(e,!1),0===e.strm.avail_out)?1:2},ye=(e,t)=>{let n,s,i;for(;;){if(e.lookahead<le){if(ge(e),e.lookahead<le&&t===H)return 1;if(0===e.lookahead)break}if(n=0,3<=e.lookahead&&(e.ins_h=ue(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-le&&(e.match_length=we(e,n),e.match_length<=5&&(e.strategy===te||3===e.match_length&&4096<e.strstart-e.match_start)&&(e.match_length=2)),3<=e.prev_length&&e.match_length<=e.prev_length){for(i=e.strstart+e.lookahead-3,s=V(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=i&&(e.ins_h=ue(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=2,e.strstart++,s&&(me(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(s=V(e,0,e.window[e.strstart-1]),s&&me(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=V(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===W?(me(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(me(e,!1),0===e.strm.avail_out)?1:2};function ve(e,t,n,s,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=s,this.func=i}const xe=[new ve(0,0,0,0,(e,t)=>{let n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(ge(e),0===e.lookahead&&t===H)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var s=e.block_start+n;if((0===e.strstart||e.strstart>=s)&&(e.lookahead=e.strstart-s,e.strstart=s,me(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-le&&(me(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===W?(me(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(me(e,!1),e.strm.avail_out),1)}),new ve(4,4,8,4,be),new ve(4,5,16,8,be),new ve(4,6,32,32,be),new ve(4,4,16,16,ye),new ve(8,16,32,32,ye),new ve(8,16,128,128,ye),new ve(8,32,128,256,ye),new ve(32,128,258,1024,ye),new ve(32,258,258,4096,ye)];function ke(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=re,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),ce(this.dyn_ltree),ce(this.dyn_dtree),ce(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),ce(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),ce(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ee=e=>{if(!e||!e.state)return de(e,$);e.total_in=e.total_out=0,e.data_type=ae;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=H,Z(t),j},Ae=e=>{var t=Ee(e);return t===j&&((e=e.state).window_size=2*e.w_size,ce(e.head),e.max_lazy_match=xe[e.level].max_lazy,e.good_match=xe[e.level].good_length,e.nice_match=xe[e.level].nice_length,e.max_chain_length=xe[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),t},ze=(e,t,n,s,i,a)=>{if(!e)return $;let r=1;if(t===ee&&(t=6),s<0?(r=0,s=-s):15<s&&(r=2,s-=16),i<1||9<i||n!==re||s<8||15<s||t<0||9<t||a<0||a>ie)return de(e,$);8===s&&(s=9);const o=new ke;return e.state=o,o.strm=e,o.wrap=r,o.gzhead=null,o.w_bits=s,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.d_buf=+o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=t,o.strategy=a,o.method=n,Ae(e)};var Te=ze,Le=(Ae,Ee,(e,t)=>!e||!e.state||2!==e.state.wrap?$:(e.state.gzhead=t,j)),Se=(n,e)=>{let t,s;if(!n||!n.state||e>X||e<0)return n?de(n,$):$;const i=n.state;if(!n.output||!n.input&&0!==n.avail_in||666===i.status&&e!==W)return de(n,0===n.avail_out?J:$);i.strm=n;var a=i.last_flush;if(i.last_flush=e,42===i.status)if(2===i.wrap)n.adler=0,_e(i,31),_e(i,139),_e(i,8),i.gzhead?(_e(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),_e(i,255&i.gzhead.time),_e(i,i.gzhead.time>>8&255),_e(i,i.gzhead.time>>16&255),_e(i,i.gzhead.time>>24&255),_e(i,9===i.level?2:i.strategy>=ne||i.level<2?4:0),_e(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(_e(i,255&i.gzhead.extra.length),_e(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(n.adler=B(n.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(_e(i,0),_e(i,0),_e(i,0),_e(i,0),_e(i,0),_e(i,9===i.level?2:i.strategy>=ne||i.level<2?4:0),_e(i,3),i.status=113);else{let e=re+(i.w_bits-8<<4)<<8,t;t=i.strategy>=ne||i.level<2?0:i.level<6?1:6===i.level?2:3,e|=t<<6,0!==i.strstart&&(e|=32),e+=31-e%31,i.status=113,pe(i,e),0!==i.strstart&&(pe(i,n.adler>>>16),pe(i,65535&n.adler)),n.adler=1}if(69===i.status)if(i.gzhead.extra){for(t=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>t&&(n.adler=B(n.adler,i.pending_buf,i.pending-t,t)),fe(n),t=i.pending,i.pending!==i.pending_buf_size));)_e(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>t&&(n.adler=B(n.adler,i.pending_buf,i.pending-t,t)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){t=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>t&&(n.adler=B(n.adler,i.pending_buf,i.pending-t,t)),fe(n),t=i.pending,i.pending===i.pending_buf_size)){s=1;break}}while(s=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,_e(i,s),0!==s);i.gzhead.hcrc&&i.pending>t&&(n.adler=B(n.adler,i.pending_buf,i.pending-t,t)),0===s&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){t=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>t&&(n.adler=B(n.adler,i.pending_buf,i.pending-t,t)),fe(n),t=i.pending,i.pending===i.pending_buf_size)){s=1;break}}while(s=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,_e(i,s),0!==s);i.gzhead.hcrc&&i.pending>t&&(n.adler=B(n.adler,i.pending_buf,i.pending-t,t)),0===s&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&fe(n),i.pending+2<=i.pending_buf_size&&(_e(i,255&n.adler),_e(i,n.adler>>8&255),n.adler=0,i.status=113)):i.status=113),0!==i.pending){if(fe(n),0===n.avail_out)return i.last_flush=-1,j}else if(0===n.avail_in&&he(e)<=he(a)&&e!==W)return de(n,J);if(666===i.status&&0!==n.avail_in)return de(n,J);if(0!==n.avail_in||0!==i.lookahead||e!==H&&666!==i.status){a=i.strategy===ne?((e,t)=>{for(var n;;){if(0===e.lookahead&&(ge(e),0===e.lookahead)){if(t===H)return 1;break}if(e.match_length=0,n=V(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(me(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===W?(me(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(me(e,!1),0===e.strm.avail_out)?1:2})(i,e):i.strategy===se?((e,t)=>{let n,s,i,a;for(var r=e.window;;){if(e.lookahead<=oe){if(ge(e),e.lookahead<=oe&&t===H)return 1;if(0===e.lookahead)break}if(e.match_length=0,3<=e.lookahead&&0<e.strstart&&(i=e.strstart-1,s=r[i],s===r[++i]&&s===r[++i]&&s===r[++i])){for(a=e.strstart+oe;s===r[++i]&&s===r[++i]&&s===r[++i]&&s===r[++i]&&s===r[++i]&&s===r[++i]&&s===r[++i]&&s===r[++i]&&i<a;);e.match_length=oe-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(3<=e.match_length?(n=V(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=V(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(me(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===W?(me(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(me(e,!1),0===e.strm.avail_out)?1:2})(i,e):xe[i.level].func(i,e);if(3!==a&&4!==a||(i.status=666),1===a||3===a)return 0===n.avail_out&&(i.last_flush=-1),j;if(2===a&&(e===K?Y(i):e!==X&&(M(i,0,0,!1),e===G&&(ce(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),fe(n),0===n.avail_out))return i.last_flush=-1,j}return e!==W?j:i.wrap<=0?q:(2===i.wrap?(_e(i,255&n.adler),_e(i,n.adler>>8&255),_e(i,n.adler>>16&255),_e(i,n.adler>>24&255),_e(i,255&n.total_in),_e(i,n.total_in>>8&255),_e(i,n.total_in>>16&255),_e(i,n.total_in>>24&255)):(pe(i,n.adler>>>16),pe(i,65535&n.adler)),fe(n),0<i.wrap&&(i.wrap=-i.wrap),0!==i.pending?j:q)},Ie=e=>{if(!e||!e.state)return $;var t=e.state.status;return 42!==t&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?de(e,$):(e.state=null,113===t?de(e,Q):j)},Oe=(e,t)=>{let n=t.length;if(!e||!e.state)return $;const s=e.state,i=s.wrap;if(2===i||1===i&&42!==s.status||s.lookahead)return $;if(1===i&&(e.adler=U(e.adler,t,n,0)),s.wrap=0,n>=s.w_size){0===i&&(ce(s.head),s.strstart=0,s.block_start=0,s.insert=0);let e=new Uint8Array(s.w_size);e.set(t.subarray(n-s.w_size,n),0),t=e,n=s.w_size}var a=e.avail_in,r=e.next_in,o=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,ge(s);3<=s.lookahead;){let e=s.strstart,t=s.lookahead-2;for(;s.ins_h=ue(s,s.ins_h,s.window[e+3-1]),s.prev[e&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=e,e++,--t;);s.strstart=e,s.lookahead=2,ge(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,e.next_in=r,e.input=o,e.avail_in=a,s.wrap=i,j};const Ce=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);function Re(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)Ce(n,t)&&(e[t]=n[t])}}return e}var Ue=s=>{let n=0;for(let e=0,t=s.length;e<t;e++)n+=s[e].length;const i=new Uint8Array(n);for(let e=0,t=0,n=s.length;e<n;e++){var a=s[e];i.set(a,t),t+=a.length}return i};let De=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){De=!1}const Be=new Uint8Array(256);for(let e=0;e<256;e++)Be[e]=252<=e?6:248<=e?5:240<=e?4:224<=e?3:192<=e?2:1;Be[254]=Be[254]=1;function Ne(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Pe=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,s,i,a,r=e.length,o=0;for(i=0;i<r;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<r&&(s=e.charCodeAt(i+1),56320==(64512&s)&&(n=65536+(n-55296<<10)+(s-56320),i++)),o+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(o),a=0,i=0;a<o;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<r&&(s=e.charCodeAt(i+1),56320==(64512&s)&&(n=65536+(n-55296<<10)+(s-56320),i++)),n<128?t[a++]=n:(n<2048?t[a++]=192|n>>>6:(n<65536?t[a++]=224|n>>>12:(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63),t[a++]=128|n>>>6&63),t[a++]=128|63&n);return t};const Ze=Object.prototype.toString,{Z_NO_FLUSH:Me,Z_SYNC_FLUSH:Fe,Z_FULL_FLUSH:Ve,Z_FINISH:Ye,Z_OK:He,Z_STREAM_END:Ke,Z_DEFAULT_COMPRESSION:Ge,Z_DEFAULT_STRATEGY:We,Z_DEFLATED:Xe}=P;function je(e){this.options=Re({level:Ge,method:Xe,chunkSize:16384,windowBits:15,memLevel:8,strategy:We},e||{});let t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ne,this.strm.avail_out=0;let n=Te(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==He)throw new Error(N[n]);if(t.header&&Le(this.strm,t.header),t.dictionary){e="string"==typeof t.dictionary?Pe(t.dictionary):"[object ArrayBuffer]"===Ze.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary;if(n=Oe(this.strm,e),n!==He)throw new Error(N[n]);this._dict_set=!0}}function qe(e,t){const n=new je(t);if(n.push(e,!0),n.err)throw n.msg||N[n.err];return n.result}je.prototype.push=function(e,t){const n=this.strm,s=this.options.chunkSize;var i,a;if(this.ended)return!1;for(a=t===~~t?t:!0===t?Ye:Me,"string"==typeof e?n.input=Pe(e):"[object ArrayBuffer]"===Ze.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(s),n.next_out=0,n.avail_out=s),(a===Fe||a===Ve)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(Se(n,a)===Ke)return 0<n.next_out&&this.onData(n.output.subarray(0,n.next_out)),i=Ie(this.strm),this.onEnd(i),this.ended=!0,i===He;if(0!==n.avail_out){if(0<a&&0<n.next_out)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},je.prototype.onData=function(e){this.chunks.push(e)},je.prototype.onEnd=function(e){e===He&&(this.result=Ue(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var $e={Deflate:je,deflate:qe,deflateRaw:function(e,t){return(t=t||{}).raw=!0,qe(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,qe(e,t)},constants:P};const Qe=15,Je=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),et=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),tt=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),nt=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var st=(e,t,n,s,i,a,r,o)=>{var l=o.bits;let d,h,c,u,f,m,_=0,p=0,w=0,g=0,b=0,y=0,v=0,x=0,k=0,E=0,A=null,z=0;const T=new Uint16Array(16),L=new Uint16Array(16);let S,I,O,C=null,R=0;for(_=0;_<=Qe;_++)T[_]=0;for(p=0;p<s;p++)T[t[n+p]]++;for(b=l,g=Qe;1<=g&&0===T[g];g--);if(b>g&&(b=g),0===g)return i[a++]=20971520,i[a++]=20971520,o.bits=1,0;for(w=1;w<g&&0===T[w];w++);for(b<w&&(b=w),x=1,_=1;_<=Qe;_++)if(x<<=1,x-=T[_],x<0)return-1;if(0<x&&(0===e||1!==g))return-1;for(L[1]=0,_=1;_<Qe;_++)L[_+1]=L[_]+T[_];for(p=0;p<s;p++)0!==t[n+p]&&(r[L[t[n+p]]++]=p);if(m=0===e?(A=C=r,19):1===e?(A=Je,z-=257,C=et,R-=257,256):(A=tt,C=nt,-1),E=0,p=0,_=w,f=a,y=b,v=0,c=-1,k=1<<b,u=k-1,1===e&&852<k||2===e&&592<k)return 1;for(;;){for(S=_-v,O=r[p]<m?(I=0,r[p]):r[p]>m?(I=C[R+r[p]],A[z+r[p]]):(I=96,0),d=1<<_-v,h=1<<y,w=h;h-=d,i[f+(E>>v)+h]=S<<24|I<<16|O|0,0!==h;);for(d=1<<_-1;E&d;)d>>=1;if(0!==d?(E&=d-1,E+=d):E=0,p++,0==--T[_]){if(_===g)break;_=t[n+r[p]]}if(_>b&&(E&u)!==c){for(0===v&&(v=b),f+=w,y=_-v,x=1<<y;y+v<g&&(x-=T[y+v],!(x<=0));)y++,x<<=1;if(k+=1<<y,1===e&&852<k||2===e&&592<k)return 1;c=E&u,i[c]=b<<24|y<<16|f-a|0}}return 0!==E&&(i[f+E]=_-v<<24|64<<16|0),o.bits=b,0};const{Z_FINISH:it,Z_BLOCK:at,Z_TREES:rt,Z_OK:ot,Z_STREAM_END:lt,Z_NEED_DICT:dt,Z_STREAM_ERROR:ht,Z_DATA_ERROR:ct,Z_MEM_ERROR:ut,Z_BUF_ERROR:ft,Z_DEFLATED:mt}=P,_t=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function pt(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const wt=e=>{if(!e||!e.state)return ht;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,ot},gt=e=>{if(!e||!e.state)return ht;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,wt(e)},bt=(e,t)=>{let n;if(!e||!e.state)return ht;const s=e.state;return t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?ht:(null!==s.window&&s.wbits!==t&&(s.window=null),s.wrap=n,s.wbits=t,gt(e))},yt=(e,t)=>{if(!e)return ht;const n=new pt;e.state=n,n.window=null;t=bt(e,t);return t!==ot&&(e.state=null),t};let vt,xt,kt=!0;const Et=(e,t,n,s)=>{let i;const a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),s>=a.wsize?(a.window.set(t.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):(i=a.wsize-a.wnext,i>s&&(i=s),a.window.set(t.subarray(n-s,n-s+i),a.wnext),(s-=i)?(a.window.set(t.subarray(n-s,n),0),a.wnext=s,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0};function At(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var zt=gt,Tt=(bt,wt,yt),Lt=(e,t)=>{let n,s,i,a,r,o,l,d,h,c,u,f,m,_,p,w,g,b,y,v,x,k,E=0;const A=new Uint8Array(4);let z,T;var L=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return ht;n=e.state,12===n.mode&&(n.mode=13),r=e.next_out,i=e.output,l=e.avail_out,a=e.next_in,s=e.input,o=e.avail_in,d=n.hold,h=n.bits,c=o,u=l,k=ot;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;h<16;){if(0===o)break e;o--,d+=s[a++]<<h,h+=8}if(2&n.wrap&&35615===d){n.check=0,A[0]=255&d,A[1]=d>>>8&255,n.check=B(n.check,A,2,0),d=0,h=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",n.mode=30;break}if((15&d)!==mt){e.msg="unknown compression method",n.mode=30;break}if(d>>>=4,h-=4,x=8+(15&d),0===n.wbits)n.wbits=x;else if(x>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<n.wbits,e.adler=n.check=1,n.mode=512&d?10:12,d=0,h=0;break;case 2:for(;h<16;){if(0===o)break e;o--,d+=s[a++]<<h,h+=8}if(n.flags=d,(255&n.flags)!==mt){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=d>>8&1),512&n.flags&&(A[0]=255&d,A[1]=d>>>8&255,n.check=B(n.check,A,2,0)),d=0,h=0,n.mode=3;case 3:for(;h<32;){if(0===o)break e;o--,d+=s[a++]<<h,h+=8}n.head&&(n.head.time=d),512&n.flags&&(A[0]=255&d,A[1]=d>>>8&255,A[2]=d>>>16&255,A[3]=d>>>24&255,n.check=B(n.check,A,4,0)),d=0,h=0,n.mode=4;case 4:for(;h<16;){if(0===o)break e;o--,d+=s[a++]<<h,h+=8}n.head&&(n.head.xflags=255&d,n.head.os=d>>8),512&n.flags&&(A[0]=255&d,A[1]=d>>>8&255,n.check=B(n.check,A,2,0)),d=0,h=0,n.mode=5;case 5:if(1024&n.flags){for(;h<16;){if(0===o)break e;o--,d+=s[a++]<<h,h+=8}n.length=d,n.head&&(n.head.extra_len=d),512&n.flags&&(A[0]=255&d,A[1]=d>>>8&255,n.check=B(n.check,A,2,0)),d=0,h=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&(f=n.length,f>o&&(f=o),f&&(n.head&&(x=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(s.subarray(a,a+f),x)),512&n.flags&&(n.check=B(n.check,s,f,a)),o-=f,a+=f,n.length-=f),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===o)break e;for(f=0;x=s[a+f++],n.head&&x&&n.length<65536&&(n.head.name+=String.fromCharCode(x)),x&&f<o;);if(512&n.flags&&(n.check=B(n.check,s,f,a)),o-=f,a+=f,x)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===o)break e;for(f=0;x=s[a+f++],n.head&&x&&n.length<65536&&(n.head.comment+=String.fromCharCode(x)),x&&f<o;);if(512&n.flags&&(n.check=B(n.check,s,f,a)),o-=f,a+=f,x)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;h<16;){if(0===o)break e;o--,d+=s[a++]<<h,h+=8}if(d!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}d=0,h=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;h<32;){if(0===o)break e;o--,d+=s[a++]<<h,h+=8}e.adler=n.check=_t(d),d=0,h=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=r,e.avail_out=l,e.next_in=a,e.avail_in=o,n.hold=d,n.bits=h,dt;e.adler=n.check=1,n.mode=12;case 12:if(t===at||t===rt)break e;case 13:if(n.last){d>>>=7&h,h-=7&h,n.mode=27;break}for(;h<3;){if(0===o)break e;o--,d+=s[a++]<<h,h+=8}switch(n.last=1&d,d>>>=1,--h,3&d){case 0:n.mode=14;break;case 1:if((t=>{if(kt){vt=new Int32Array(512),xt=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(st(1,t.lens,0,288,vt,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;st(2,t.lens,0,32,xt,0,t.work,{bits:5}),kt=!1}t.lencode=vt,t.lenbits=9,t.distcode=xt,t.distbits=5})(n),n.mode=20,t!==rt)break;d>>>=2,h-=2;break e;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}d>>>=2,h-=2;break;case 14:for(d>>>=7&h,h-=7&h;h<32;){if(0===o)break e;o--,d+=s[a++]<<h,h+=8}if((65535&d)!=(d>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&d,d=0,h=0,n.mode=15,t===rt)break e;case 15:n.mode=16;case 16:if(f=n.length,f){if(f>o&&(f=o),f>l&&(f=l),0===f)break e;i.set(s.subarray(a,a+f),r),o-=f,a+=f,l-=f,r+=f,n.length-=f;break}n.mode=12;break;case 17:for(;h<14;){if(0===o)break e;o--,d+=s[a++]<<h,h+=8}if(n.nlen=257+(31&d),d>>>=5,h-=5,n.ndist=1+(31&d),d>>>=5,h-=5,n.ncode=4+(15&d),d>>>=4,h-=4,286<n.nlen||30<n.ndist){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;h<3;){if(0===o)break e;o--,d+=s[a++]<<h,h+=8}n.lens[L[n.have++]]=7&d,d>>>=3,h-=3}for(;n.have<19;)n.lens[L[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,z={bits:n.lenbits},k=st(0,n.lens,0,19,n.lencode,0,n.work,z),n.lenbits=z.bits,k){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;E=n.lencode[d&(1<<n.lenbits)-1],p=E>>>24,w=E>>>16&255,g=65535&E,!(p<=h);){if(0===o)break e;o--,d+=s[a++]<<h,h+=8}if(g<16)d>>>=p,h-=p,n.lens[n.have++]=g;else{if(16===g){for(T=p+2;h<T;){if(0===o)break e;o--,d+=s[a++]<<h,h+=8}if(d>>>=p,h-=p,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}x=n.lens[n.have-1],f=3+(3&d),d>>>=2,h-=2}else if(17===g){for(T=p+3;h<T;){if(0===o)break e;o--,d+=s[a++]<<h,h+=8}d>>>=p,h-=p,x=0,f=3+(7&d),d>>>=3,h-=3}else{for(T=p+7;h<T;){if(0===o)break e;o--,d+=s[a++]<<h,h+=8}d>>>=p,h-=p,x=0,f=11+(127&d),d>>>=7,h-=7}if(n.have+f>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;f--;)n.lens[n.have++]=x}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,z={bits:n.lenbits},k=st(1,n.lens,0,n.nlen,n.lencode,0,n.work,z),n.lenbits=z.bits,k){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,z={bits:n.distbits},k=st(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,z),n.distbits=z.bits,k){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,t===rt)break e;case 20:n.mode=21;case 21:if(6<=o&&258<=l){e.next_out=r,e.avail_out=l,e.next_in=a,e.avail_in=o,n.hold=d,n.bits=h,function(e,t){let n,s,i,a,r,o,l,d,h,c,u,f,m,_,p,w,g,b,y,v,x,k,E,A;const z=e.state;n=e.next_in,E=e.input,s=n+(e.avail_in-5),i=e.next_out,A=e.output,a=i-(t-e.avail_out),r=i+(e.avail_out-257),o=z.dmax,l=z.wsize,d=z.whave,h=z.wnext,c=z.window,u=z.hold,f=z.bits,m=z.lencode,_=z.distcode,p=(1<<z.lenbits)-1,w=(1<<z.distbits)-1;t:do{for(f<15&&(u+=E[n++]<<f,f+=8,u+=E[n++]<<f,f+=8),g=m[u&p];;){if(b=g>>>24,u>>>=b,f-=b,b=g>>>16&255,0===b)A[i++]=65535&g;else{if(!(16&b)){if(0==(64&b)){g=m[(65535&g)+(u&(1<<b)-1)];continue}if(32&b){z.mode=12;break t}e.msg="invalid literal/length code",z.mode=30;break t}for(y=65535&g,b&=15,b&&(f<b&&(u+=E[n++]<<f,f+=8),y+=u&(1<<b)-1,u>>>=b,f-=b),f<15&&(u+=E[n++]<<f,f+=8,u+=E[n++]<<f,f+=8),g=_[u&w];;){if(b=g>>>24,u>>>=b,f-=b,b=g>>>16&255,!(16&b)){if(0==(64&b)){g=_[(65535&g)+(u&(1<<b)-1)];continue}e.msg="invalid distance code",z.mode=30;break t}if(v=65535&g,b&=15,f<b&&(u+=E[n++]<<f,f+=8,f<b&&(u+=E[n++]<<f,f+=8)),o<(v+=u&(1<<b)-1)){e.msg="invalid distance too far back",z.mode=30;break t}if(u>>>=b,f-=b,b=i-a,v>b){if(b=v-b,b>d&&z.sane){e.msg="invalid distance too far back",z.mode=30;break t}if(x=0,k=c,0===h){if(x+=l-b,b<y){for(y-=b;A[i++]=c[x++],--b;);x=i-v,k=A}}else if(h<b){if(x+=l+h-b,b-=h,b<y){for(y-=b;A[i++]=c[x++],--b;);if(x=0,h<y){for(b=h,y-=b;A[i++]=c[x++],--b;);x=i-v,k=A}}}else if(x+=h-b,b<y){for(y-=b;A[i++]=c[x++],--b;);x=i-v,k=A}for(;2<y;)A[i++]=k[x++],A[i++]=k[x++],A[i++]=k[x++],y-=3;y&&(A[i++]=k[x++],1<y&&(A[i++]=k[x++]))}else{for(x=i-v;A[i++]=A[x++],A[i++]=A[x++],A[i++]=A[x++],y-=3,2<y;);y&&(A[i++]=A[x++],1<y&&(A[i++]=A[x++]))}break}}break}}while(n<s&&i<r);y=f>>3,n-=y,f-=y<<3,u&=(1<<f)-1,e.next_in=n,e.next_out=i,e.avail_in=n<s?s-n+5:5-(n-s),e.avail_out=i<r?r-i+257:257-(i-r),z.hold=u,z.bits=f}(e,u),r=e.next_out,i=e.output,l=e.avail_out,a=e.next_in,s=e.input,o=e.avail_in,d=n.hold,h=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;E=n.lencode[d&(1<<n.lenbits)-1],p=E>>>24,w=E>>>16&255,g=65535&E,!(p<=h);){if(0===o)break e;o--,d+=s[a++]<<h,h+=8}if(w&&0==(240&w)){for(b=p,y=w,v=g;E=n.lencode[v+((d&(1<<b+y)-1)>>b)],p=E>>>24,w=E>>>16&255,g=65535&E,!(b+p<=h);){if(0===o)break e;o--,d+=s[a++]<<h,h+=8}d>>>=b,h-=b,n.back+=b}if(d>>>=p,h-=p,n.back+=p,n.length=g,0===w){n.mode=26;break}if(32&w){n.back=-1,n.mode=12;break}if(64&w){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&w,n.mode=22;case 22:if(n.extra){for(T=n.extra;h<T;){if(0===o)break e;o--,d+=s[a++]<<h,h+=8}n.length+=d&(1<<n.extra)-1,d>>>=n.extra,h-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;E=n.distcode[d&(1<<n.distbits)-1],p=E>>>24,w=E>>>16&255,g=65535&E,!(p<=h);){if(0===o)break e;o--,d+=s[a++]<<h,h+=8}if(0==(240&w)){for(b=p,y=w,v=g;E=n.distcode[v+((d&(1<<b+y)-1)>>b)],p=E>>>24,w=E>>>16&255,g=65535&E,!(b+p<=h);){if(0===o)break e;o--,d+=s[a++]<<h,h+=8}d>>>=b,h-=b,n.back+=b}if(d>>>=p,h-=p,n.back+=p,64&w){e.msg="invalid distance code",n.mode=30;break}n.offset=g,n.extra=15&w,n.mode=24;case 24:if(n.extra){for(T=n.extra;h<T;){if(0===o)break e;o--,d+=s[a++]<<h,h+=8}n.offset+=d&(1<<n.extra)-1,d>>>=n.extra,h-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===l)break e;if(f=u-l,n.offset>f){if(f=n.offset-f,f>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}m=f>n.wnext?(f-=n.wnext,n.wsize-f):n.wnext-f,f>n.length&&(f=n.length),_=n.window}else _=i,m=r-n.offset,f=n.length;for(f>l&&(f=l),l-=f,n.length-=f;i[r++]=_[m++],--f;);0===n.length&&(n.mode=21);break;case 26:if(0===l)break e;i[r++]=n.length,l--,n.mode=21;break;case 27:if(n.wrap){for(;h<32;){if(0===o)break e;o--,d|=s[a++]<<h,h+=8}if(u-=l,e.total_out+=u,n.total+=u,u&&(e.adler=n.check=(n.flags?B:U)(n.check,i,u,r-u)),u=l,(n.flags?d:_t(d))!==n.check){e.msg="incorrect data check",n.mode=30;break}d=0,h=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;h<32;){if(0===o)break e;o--,d+=s[a++]<<h,h+=8}if(d!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}d=0,h=0}n.mode=29;case 29:k=lt;break e;case 30:k=ct;break e;case 31:return ut;default:return ht}return e.next_out=r,e.avail_out=l,e.next_in=a,e.avail_in=o,n.hold=d,n.bits=h,(n.wsize||u!==e.avail_out&&n.mode<30&&(n.mode<27||t!==it))&&Et(e,e.output,e.next_out,u-e.avail_out),c-=e.avail_in,u-=e.avail_out,e.total_in+=c,e.total_out+=u,n.total+=u,n.wrap&&u&&(e.adler=n.check=(n.flags?B:U)(n.check,i,u,e.next_out-u)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0==c&&0===u||t===it)&&k===ot&&(k=ft),k},St=e=>{if(!e||!e.state)return ht;let t=e.state;return t.window&&(t.window=null),e.state=null,ot},It=(e,t)=>{if(!e||!e.state)return ht;const n=e.state;return 0==(2&n.wrap)?ht:((n.head=t).done=!1,ot)},Ot=(e,t)=>{var n=t.length;let s;return e&&e.state?(s=e.state,0!==s.wrap&&11!==s.mode?ht:11===s.mode&&U(1,t,n,0)!==s.check?ct:Et(e,t,n,n)?(s.mode=31,ut):(s.havedict=1,ot)):ht};const Ct=Object.prototype.toString,{Z_NO_FLUSH:Rt,Z_FINISH:Ut,Z_OK:Dt,Z_STREAM_END:Bt,Z_NEED_DICT:Nt,Z_STREAM_ERROR:Pt,Z_DATA_ERROR:Zt,Z_MEM_ERROR:Mt}=P;function Ft(e){this.options=Re({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ne,this.strm.avail_out=0;let n=Tt(this.strm,t.windowBits);if(n!==Dt)throw new Error(N[n]);if(this.header=new At,It(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Pe(t.dictionary):"[object ArrayBuffer]"===Ct.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Ot(this.strm,t.dictionary),n!==Dt)))throw new Error(N[n])}function Vt(e,t){const n=new Ft(t);if(n.push(e),n.err)throw n.msg||N[n.err];return n.result}Ft.prototype.push=function(e,t){const n=this.strm,s=this.options.chunkSize,i=this.options.dictionary;let a,r,o;if(this.ended)return!1;for(r=t===~~t?t:!0===t?Ut:Rt,"[object ArrayBuffer]"===Ct.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(s),n.next_out=0,n.avail_out=s),a=Lt(n,r),a===Nt&&i&&(a=Ot(n,i),a===Dt?a=Lt(n,r):a===Zt&&(a=Nt));0<n.avail_in&&a===Bt&&0<n.state.wrap&&0!==e[n.next_in];)zt(n),a=Lt(n,r);switch(a){case Pt:case Zt:case Nt:case Mt:return this.onEnd(a),!(this.ended=!0)}var l,d,h;if(o=n.avail_out,!n.next_out||0!==n.avail_out&&a!==Bt||("string"===this.options.to?(l=((e,t)=>{let n=(t=(t=t||e.length)>e.length?e.length:t)-1;for(;0<=n&&128==(192&e[n]);)n--;return!(n<0||0===n)&&n+Be[e[n]]>t?n:t})(n.output,n.next_out),d=n.next_out-l,h=((n,e)=>{var s=e||n.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(n.subarray(0,e));let i,a;const r=new Array(2*s);for(a=0,i=0;i<s;){let t=n[i++];if(t<128)r[a++]=t;else{let e=Be[t];if(4<e)r[a++]=65533,i+=e-1;else{for(t&=2===e?31:3===e?15:7;1<e&&i<s;)t=t<<6|63&n[i++],e--;1<e?r[a++]=65533:t<65536?r[a++]=t:(t-=65536,r[a++]=55296|t>>10&1023,r[a++]=56320|1023&t)}}}return((t,n)=>{if(n<65534&&t.subarray&&De)return String.fromCharCode.apply(null,t.length===n?t:t.subarray(0,n));let s="";for(let e=0;e<n;e++)s+=String.fromCharCode(t[e]);return s})(r,a)})(n.output,l),n.next_out=d,n.avail_out=s-d,d&&n.output.set(n.output.subarray(l,l+d),0),this.onData(h)):this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out))),a!==Dt||0!==o){if(a===Bt)return a=St(this.strm),this.onEnd(a),this.ended=!0;if(0===n.avail_in)break}}return!0},Ft.prototype.onData=function(e){this.chunks.push(e)},Ft.prototype.onEnd=function(e){e===Dt&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ue(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var{Deflate:Yt,deflate:Ht,deflateRaw:Kt,gzip:Gt}=$e,{Inflate:Wt,inflate:Xt,inflateRaw:jt,ungzip:R}={Inflate:Ft,inflate:Vt,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Vt(e,t)},ungzip:Vt},$e=Ht,Ht=Kt,Kt=Gt,Gt=Wt,Wt=Xt,Xt=jt,jt=R,R=P,P={Deflate:Yt,deflate:$e,deflateRaw:Ht,gzip:Kt,Inflate:Gt,inflate:Wt,inflateRaw:Xt,ungzip:jt,constants:R};e.Deflate=Yt,e.Inflate=Gt,e.constants=R,e.default=P,e.deflate=$e,e.deflateRaw=Ht,e.gzip=Kt,e.inflate=Wt,e.inflateRaw=Xt,e.ungzip=jt,Object.defineProperty(e,"__esModule",{value:!0})});